"use strict";var e=require("../../common/vendor.js"),t=require("../../common/util.js");const i={components:{uniLoadMore:()=>"../../components/uni-load-more.js",noData:()=>"../../components/nodata.js",newsItem:()=>"./news-item.js"},props:{nid:{type:[Number,String],default:""}},data:()=>({dataList:[],navigateFlag:!1,pulling:!1,refreshing:!1,refreshFlag:!1,refreshText:"",isLoading:!1,loadingText:"加载中...",isNoData:!1,pulling:!1,angle:0,loadingMoreText:{contentdown:"",contentrefresh:"",contentnomore:""},refreshIcon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAB5QTFRFcHBw3Nzct7e39vb2ycnJioqK7e3tpqam29vb////D8oK7wAAAAp0Uk5T////////////ALLMLM8AAABxSURBVHja7JVBDoAgDASrjqj//7CJBi90iyYeOHTPMwmFZrHjYyyFYYUy1bwUZqtJIYVxhf1a6u0R7iUvWsCcrEtwJHp8MwMdvh2amHduiZD3rpWId9+BgPd7Cc2LIkPyqvlQvKxKBJ//Qwq/CacAAwDUv0a0YuKhzgAAAABJRU5ErkJggg=="}),created(){this.pullTimer=null,this.requestParams={columnId:this.nid,minId:0,pageSize:10,column:"id,post_id,title,author_name,cover,published_at,comments_count"},this._isWidescreen=!1},methods:{loadData(i){this.isLoading||(this.isLoading=!0,this.isNoData=!1,this.requestParams.time=(new Date).getTime()+"",e.index.request({url:"https://unidemo.dcloud.net.cn/api/news",data:this.requestParams,success:e=>{const s=e.data;this.isNoData=s.length<=0;const a=s.map((e=>({id:this.newGuid()+e.id,newsid:e.id,article_type:1,datetime:t.friendlyDate(new Date(e.published_at.replace(/\-/g,"/")).getTime()),title:e.title,image_url:e.cover,source:e.author_name,comment_count:e.comments_count,post_id:e.post_id})));i?(this.dataList=a,this.requestParams.minId=0):(this.dataList=this.dataList.concat(a),this.requestParams.minId=s[s.length-1].id),this.dataList.length>0&&this._isWidescreen&&this.dataList.length<=10&&this.goDetail(this.dataList[0])},fail:e=>{0==this.dataList.length&&(this.isNoData=!0)},complete:e=>{this.isLoading=!1,i&&(this.refreshing=!1,this.refreshFlag=!1,this.refreshText="已刷新",this.pullTimer&&clearTimeout(this.pullTimer),this.pullTimer=setTimeout((()=>{this.pulling=!1}),1e3))}}))},loadMore(e){this.loadData()},clear(){this.dataList.length=0,this.requestParams.minId=0},goDetail(t){this._isWidescreen?e.index.$emit("updateDetail",{detail:encodeURIComponent(JSON.stringify(t))}):e.index.navigateTo({url:"./detail?query="+encodeURIComponent(JSON.stringify(t))})},closeItem(t){e.index.showModal({content:"不感兴趣？",success:e=>{e.confirm&&this.dataList.splice(t,1)}})},refreshData(){this.isLoading||(this.pulling=!0,this.refreshing=!0,this.refreshText="正在刷新...",this.loadData(!0))},onrefresh(e){this.refreshData()},onpullingdown(e){this.refreshing||(this.pulling=!1,Math.abs(e.pullingDistance)>Math.abs(e.viewHeight)?(this.refreshFlag=!0,this.refreshText="释放立即刷新"):(this.refreshFlag=!1,this.refreshText="下拉可以刷新"))},newGuid(){let e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return(e()+e()+"-"+e()+"-4"+e().substr(0,3)+"-"+e()+"-"+e()+e()+e()).toUpperCase()}}};if(!Array){(e.resolveComponent("news-item")+e.resolveComponent("no-data"))()}var s=e._export_sfc(i,[["render",function(t,i,s,a,n,o){return e.e({a:e.f(n.dataList,((t,i,s)=>({a:e.o((e=>o.closeItem(i))),b:e.o((e=>o.goDetail(t))),c:"6ce9a22e-0-"+s,d:e.p({newsItem:t}),e:t.id}))),b:n.isLoading||n.dataList.length>4},n.isLoading||n.dataList.length>4?{c:e.t(n.loadingText)}:{},{d:e.o((e=>o.loadMore())),e:n.isNoData},n.isNoData?{f:e.o(o.loadMore)}:{})}],["__scopeId","data-v-6ce9a22e"]]);wx.createComponent(s);
